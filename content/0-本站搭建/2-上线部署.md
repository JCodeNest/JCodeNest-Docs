---
title: 上线部署
summary: JCodeNest Docs 静态站点快速部署手册
date: 2025-09-20
cover: https://jcodenest-oss.oss-cn-shanghai.aliyuncs.com/images/20250920140521425.png
---

# 上线部署

本文以 Linux 服务器为例，说明如何在生产环境部署 JCodeNest Docs。

## 前置条件

- 已安装 Git
- 已安装 Node.js 18+（建议 LTS）
- 已安装 Nginx（作为前置反向代理）

相关安装文档（任选系统对应方式）：
- Git：https://git-scm.com/downloads
- Node.js：https://nodejs.org/zh-cn/download
- Nginx：https://nginx.org/en/linux_packages.html

## 克隆项目

```bash
git clone https://github.com/JCodeNest/JCodeNest-Docs.git
cd JCodeNest-Docs
```

## 构建项目

在项目根目录执行：

```bash
npm ci
npm run build
```

说明：
- `npm ci` 适用于干净环境（CI/服务器），更稳定一致；若有需要可使用 `npm install`。
- `npm run build` 将生成生产可运行的产物（Next.js）。

## 启动服务（推荐 PM2 守护）

使用 PM2 管理 Node 进程，支持开机自启、监控与日志。

```bash
# 安装 PM2
npm i -g pm2

# 启动服务（将 PORT 替换为实际端口；--name 可自定义）
NODE_ENV=production PORT=3000 pm2 start "npm start" --name jcodenest-docs

# 持久化与开机自启
pm2 save
pm2 startup
```

PM2 常用命令：
```bash
pm2 list          # 查看进程
pm2 stop <id|name>
pm2 restart <id|name>
pm2 delete <id|name>
pm2 logs          # 实时日志
pm2 monit         # 监控面板
```

提示：
- 若需要查看单个应用日志：pm2 logs jcodenest-docs
- 如端口被占用，请调整 PORT 或释放占用。

## 配置 Nginx（反向代理）

在 Nginx 的站点配置中加入如下示例（请根据你的域名与端口做相应修改）：

```nginx
# /etc/nginx/conf.d/jcodenest.conf 示例
upstream jcodenest_upstream {
    server 127.0.0.1:3000;  # Next.js 应用监听端口
    keepalive 64;
}

server {
    listen 80;
    server_name your.domain.com;

    # 如使用 HTTPS，建议将 80 重定向至 443
    # return 301 https://$host$request_uri;

    # 基础代理到 Next.js
    location / {
        proxy_pass http://jcodenest_upstream;
        proxy_http_version 1.1;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # WebSocket/升级头（通用兼容）
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # Next.js 静态构建产物，强缓存且 immutable
    location /_next/static/ {
        proxy_pass http://jcodenest_upstream;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 公共静态资源（/public）适度缓存（可选）
    # Next 的 /public 会映射为站点根路径，如 /favicon.ico、/robots.txt
    # 若你有自定义静态目录，可视情况添加类似规则：
    # location /static/ {
    #     proxy_pass http://jcodenest_upstream;
    #     expires 30d;
    #     add_header Cache-Control "public, max-age=2592000";
    # }

    # 如需 HTTPS：可结合 Certbot 申请并自动续期证书
    # 参考：https://certbot.eff.org/
}
```

优化建议：
- 在 http 或 server 级别开启 gzip / brotli 压缩以降低带宽与加速传输。
- 若未来有多实例部署，可将 upstream 抽到 http 级别统一管理并配置负载均衡策略。

## 防火墙与安全组

- 若以 3000 端口提供服务且由 Nginx 代理对外 80/443，通常仅开放 80/443 即可。
- 如果需要直接访问 3000 端口，请在服务器安全组/防火墙中开放相应端口。

## 重载/重启 Nginx

完成配置后重载 Nginx 使之生效：

```bash
# 推荐重载（不中断连接）
nginx -t && systemctl reload nginx

# 或重启
# nginx -t && systemctl restart nginx
```

## 验证

- 访问 http://your.domain.com
- 如使用 HTTPS，访问 https://your.domain.com
- 若页面正常呈现，即部署成功。